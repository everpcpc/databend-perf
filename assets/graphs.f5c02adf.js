import{r as i,i as Z,L as _}from"./react.7dc093bc.js";import{F as y,u as ee,g as L,a as te,b as ae,R as O,C,S as $}from"./index.bd42108c.js";import{B as ne,T as se,D as re,h as ie,f as j}from"./tools.d8b1e8c8.js";import{j as m,a as t,m as le}from"./index.52160168.js";import"./lodash.71f9f2ff.js";const{RangePicker:oe}=re,{Option:G}=$,me=()=>{const[V,T]=i.exports.useState([]),[v,A]=i.exports.useState(""),[b]=y.useForm(),[w,N]=i.exports.useState([]),[F,I]=i.exports.useState(!0),[P,S]=i.exports.useState(!1),[q,K]=i.exports.useState(""),[B,M]=i.exports.useState({filterDate:[],startIndex:0,endIndex:-1}),[W]=i.exports.useState([{name:"Raw",value:"raw"}]),[k,R]=i.exports.useState([]);ee(()=>{z()}),i.exports.useEffect(()=>{F||X()},[F]);async function X(){const e=await L(v);R(e),E(v,e,!1)}async function z(){const{types:e,env:a}=await te();if(K(a),T(e||[]),e.length>0){b.setFieldsValue({category:e[0]}),I(!0),A(e[0]);const o=await L(e[0]);R(o),E(e[0],o,!0)}}async function E(e,a,o){const d=a.length;S(!0);try{for(let s=0;s<d;s++){const c=a[s];ae(e,c).then(l=>{s===0&&N(l==null?void 0:l.xAxis),H(e,c,l,s,o)})}S(!1)}catch(s){console.log(s),S(!1)}}function H(e,a,o,d,s){const c=`${e}-${a}`,l=document.getElementById(`${c}`);if(l){let u=Z(l),{legend:g,lines:r,sql:U,title:Y,version:h,xAxis:D}=o;if(!s){const{startIndex:n,endIndex:x,filterDate:f}=B;B.endIndex===-1?(D=f,r.map(p=>{p.data=p.data.slice(n)}),h=h.slice(n)):(D=f,r.map(p=>{p.data=p.data.slice(n,x+1)}),h=h.slice(n,x+1))}r==null||r.map(n=>n.type="line"),I(!0),u.setOption({legend:{data:g,y:"bottom"},title:{left:"center",text:`${Y}`},tooltip:{trigger:"axis",position:function(n){return d%3==2?"right":d%3==1?n:[n[0]+10,0]},formatter(n){let x=`<div style="width: 500px; white-space: normal;word-wrap: break-word;">${U}</div>${n[0].axisValue}<span style="display:inline-block;padding-left: 20px;">${h[n[0].dataIndex]}</span></br>`;return n.forEach((f,p)=>{x+=`<div>${f.marker} ${f.seriesName}:${f.data}</div>`}),x}},xAxis:{data:D,name:"date"},yAxis:{name:"s"},series:r}),u=null}}function J(e){return e>ie().add(0,"days")}async function Q(){const{category:e,date:a,kind:o}=b.getFieldsValue();A(e);let d=null,s=null;a&&a.length>1&&(d=j(a[0]),s=j(a[1]));const c=w.indexOf(d),l=w.indexOf(s),u=c===-1?0:c,g=l;let r=[];if(g===-1?r=w.slice(u):r=w.slice(u,g+1),r.length<=0){le.warning("No data was generated for this time range");return}I(!1),M({filterDate:r,startIndex:u,endIndex:g})}return m("div",{children:[t(y,{form:b,initialValues:{kind:"raw",category:v},children:m(O,{gutter:10,children:[t(C,{span:6,children:t(y.Item,{name:"date",label:"Date range",children:t(oe,{disabledDate:J,style:{width:"100%"}})})}),t(C,{span:4,children:t(y.Item,{name:"kind",label:"Graph kind",children:t($,{children:W.map((e,a)=>t(G,{value:e.value,children:e.name},a))})})}),t(C,{span:4,children:t(y.Item,{name:"category",label:"Category",children:t($,{children:V.map((e,a)=>t(G,{value:e,children:e},a))})})}),t(ne,{loading:P,type:"primary",onClick:Q,children:"Submit"})]})}),m("div",{children:[m("div",{style:{marginBottom:"20px"},children:[m("div",{children:["See ",t(_,{to:"/compare",children:"compare page"})," for descriptions of what the names mean."]}),m(se,{color:"blue",children:["Environment: ",q]})]}),t(O,{id:"allChartWrap",children:k==null?void 0:k.map(e=>t(C,{span:8,style:{marginBottom:"20px"},children:t("div",{style:{height:"300px",width:"100%"},id:`${v}-${e}`})},e))})]})]})};export{me as default};
