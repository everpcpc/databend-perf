import{r,i as ee,L as te}from"./react.7dc093bc.js";import{F as C,u as ae,g as O,a as ne,b as se,R as j,C as I,S as F}from"./index.bfe72ec0.js";import{B as re,T as ie,D as le,h as oe,f as G}from"./tools.3972a8de.js";import{s as A}from"./styles.module.f478b5d2.js";import{j as d,a as t,m as de}from"./index.528827e4.js";import"./lodash.71f9f2ff.js";const{RangePicker:ce}=le,{Option:T}=F,xe=()=>{const[V,M]=r.exports.useState([]),[g,B]=r.exports.useState(""),[$]=C.useForm(),[b,P]=r.exports.useState([]),[E,w]=r.exports.useState(!0),[W,S]=r.exports.useState(!1),[q,H]=r.exports.useState(""),[L,K]=r.exports.useState({filterDate:[],startIndex:0,endIndex:-1}),[X]=r.exports.useState([{name:"Raw",value:"raw"}]),[k,R]=r.exports.useState([]);ae(()=>{J()}),r.exports.useEffect(()=>{E||z()},[E]);async function z(){const e=await O(g);R(e),N(g,e,!1)}async function J(){const{types:e,env:a}=await ne();if(H(a),M(e||[]),e.length>0){$.setFieldsValue({category:e[0]}),w(!0),B(e[0]);const o=await O(e[0]);R(o),N(e[0],o,!0)}}async function N(e,a,o){const h=a.length;S(!0);try{for(let n=0;n<h;n++){const l=a[n];se(e,l).then(i=>{n===0&&P(i==null?void 0:i.xAxis),Q(e,l,i,n,o)})}S(!1)}catch(n){console.log(n),S(!1)}}function Q(e,a,o,h,n){const l=`${e}-${a}`,i=document.getElementById(`${l}`);if(i){let x=document.getElementById(`${l}-title`),c=ee(i),{legend:u,lines:p,sql:Z,title:_,version:y,xAxis:D}=o;if(x.innerHTML=`
        <span style='display: flex'>
          <span style='font-weight: bold; padding-right: 10px;'>${_}:</span><span>${Z}</span>
        </span>
      `,!n){const{startIndex:s,endIndex:v,filterDate:f}=L;L.endIndex===-1?(D=f,p.map(m=>{m.data=m.data.slice(s)}),y=y.slice(s)):(D=f,p.map(m=>{m.data=m.data.slice(s,v+1)}),y=y.slice(s,v+1))}p==null||p.map(s=>s.type="line"),w(!0),c.setOption({legend:{data:u,y:"bottom"},tooltip:{trigger:"axis",formatter(s){let v=`${s[0].axisValue}<span style="display:inline-block;padding-left: 20px;">${y[s[0].dataIndex]}</span></br>`;return s.forEach((f,m)=>{v+=`<div>${f.marker} ${f.seriesName}:${f.data}</div>`}),v}},xAxis:{data:D,name:"date"},yAxis:{name:"s"},series:p}),c=null}}function U(e){return e>oe().add(0,"days")}async function Y(){const{category:e,date:a,kind:o}=$.getFieldsValue();B(e);let h=null,n=null;a&&a.length>1&&(h=G(a[0]),n=G(a[1]));const l=b.indexOf(h),i=b.indexOf(n),x=l===-1?0:l,c=i;let u=[];if(c===-1?u=b.slice(x):u=b.slice(x,c+1),u.length<=0){de.warning("No data was generated for this time range");return}w(!1),K({filterDate:u,startIndex:x,endIndex:c})}return d("div",{children:[t(C,{form:$,initialValues:{kind:"raw",category:g},children:d(j,{gutter:10,children:[t(I,{span:6,children:t(C.Item,{name:"date",label:"Date range",children:t(ce,{disabledDate:U,style:{width:"100%"}})})}),t(I,{span:4,children:t(C.Item,{name:"kind",label:"Graph kind",children:t(F,{children:X.map((e,a)=>t(T,{value:e.value,children:e.name},a))})})}),t(I,{span:4,children:t(C.Item,{name:"category",label:"Category",children:t(F,{children:V.map((e,a)=>t(T,{value:e,children:e},a))})})}),t(re,{loading:W,type:"primary",onClick:Y,children:"Submit"})]})}),d("div",{children:[d("div",{style:{marginBottom:"20px"},children:[d("div",{children:["See ",t(te,{to:"/compare",children:"compare page"})," for descriptions of what the names mean."]}),d(ie,{color:"blue",children:["Environment: ",q]})]}),t(j,{className:A.allChartWrap,id:"allChartWrap",gutter:10,children:k==null?void 0:k.map(e=>t(I,{span:8,style:{marginBottom:"20px"},children:d("div",{className:A.content,children:[t("div",{className:A.title,id:`${g}-${e}-title`}),t("div",{style:{height:"300px",width:"100%",background:"#fff"},id:`${g}-${e}`})]})},e))})]})]})};export{xe as default};
