import{r as s,i as ae,L as ne}from"./react.7dc093bc.js";import{d as se,F as w,u as re,g as N,a as ie,b as le,R as j,C as I,S as F}from"./device-type.faefe4b8.js";import{B as oe,T as de,D as ce,h as ue,f as G}from"./tools.0682cfee.js";import{s as B}from"./styles.module.a3c36dde.js";import{j as c,a as t,m as pe}from"./index.0dee21a9.js";import"./lodash.71f9f2ff.js";const{RangePicker:fe}=ce,{Option:V}=F,Ce=()=>{const{isPhone:o}=se(),[P,z]=s.exports.useState([]),[x,R]=s.exports.useState(""),[$]=w.useForm(),[b,M]=s.exports.useState([]),[T,S]=s.exports.useState(!0),[W,k]=s.exports.useState(!1),[q,H]=s.exports.useState(""),K=s.exports.useRef(null),[E,X]=s.exports.useState({filterDate:[],startIndex:0,endIndex:-1}),[J]=s.exports.useState([{name:"Raw",value:"raw"}]),[D,L]=s.exports.useState([]);re(()=>{U()}),s.exports.useEffect(()=>{T||Q()},[T]);async function Q(){const e=await N(x);L(e),O(x,e,!1)}async function U(){const{types:e,env:a}=await ie();if(H(a),z(e||[]),e.length>0){$.setFieldsValue({category:e[0]}),S(!0),R(e[0]);const d=await N(e[0]);L(d),O(e[0],d,!0)}}async function O(e,a,d){const h=a.length;k(!0);try{for(let n=0;n<h;n++){const l=a[n];le(e,l).then(i=>{n===0&&M(i==null?void 0:i.xAxis),Y(e,l,i,n,d)})}k(!1)}catch(n){console.log(n),k(!1)}}function Y(e,a,d,h,n){const l=`${e}-${a}`,i=document.getElementById(`${l}`);if(i){let y=document.getElementById(`${l}-title`),u=ae(i),{legend:p,lines:f,sql:ee,title:te,version:v,xAxis:A}=d;if(y.innerHTML=`
        <span style='display: flex;'>
          <span style='font-weight: bold; padding-right: 10px;'>${te}:</span><span style="font-size: 12px;">${ee}</span>
        </span>
      `,!n){const{startIndex:r,endIndex:C,filterDate:m}=E;E.endIndex===-1?(A=m,f.map(g=>{g.data=g.data.slice(r)}),v=v.slice(r)):(A=m,f.map(g=>{g.data=g.data.slice(r,C+1)}),v=v.slice(r,C+1))}f==null||f.map(r=>r.type="line"),S(!0),u.setOption({legend:{data:p,y:"bottom"},tooltip:{extraCssText:"z-index: 10",trigger:"axis",position:o?["20%","-30%"]:void 0,formatter(r){let C=`${r[0].axisValue}<span style="display:inline-block;padding-left: 20px;">${v[r[0].dataIndex]}</span></br>`;return r.forEach((m,g)=>{C+=`<div>${m.marker} ${m.seriesName}:${m.data}</div>`}),C}},xAxis:{data:A,name:o?"":"date"},yAxis:{name:"s"},series:f}),u=null}}function Z(e){return e>ue().add(0,"days")}async function _(){const{category:e,date:a,kind:d}=$.getFieldsValue();R(e);let h=null,n=null;a&&a.length>1&&(h=G(a[0]),n=G(a[1]));const l=b.indexOf(h),i=b.indexOf(n),y=l===-1?0:l,u=i;let p=[];if(u===-1?p=b.slice(y):p=b.slice(y,u+1),p.length<=0){pe.warning("No data was generated for this time range");return}S(!1),X({filterDate:p,startIndex:y,endIndex:u})}return c("div",{children:[t(w,{form:$,initialValues:{kind:"raw",category:x},children:c(j,{gutter:10,children:[t(I,{span:o?24:6,children:t(w.Item,{name:"date",label:"Date range",children:t(fe,{inputReadOnly:!0,ref:K,disabledDate:Z,style:{width:"100%"}})})}),t(I,{span:o?12:4,children:t(w.Item,{name:"kind",label:"Graph kind",children:t(F,{children:J.map((e,a)=>t(V,{value:e.value,children:e.name},a))})})}),t(I,{span:o?12:4,children:t(w.Item,{name:"category",label:"Category",children:t(F,{children:P.map((e,a)=>t(V,{value:e,children:e},a))})})}),t(oe,{style:o?{width:"100%",marginBottom:"20px"}:{width:"auto"},loading:W,type:"primary",onClick:_,children:"Submit"})]})}),c("div",{children:[c("div",{style:{marginBottom:"20px"},children:[c("div",{children:["See ",t(ne,{to:"/compare",children:"compare page"})," for descriptions of what the names mean."]}),c(de,{style:{marginTop:"5px"},color:"blue",children:["Environment: ",q]})]}),t(j,{className:B.allChartWrap,id:"allChartWrap",gutter:10,children:D==null?void 0:D.map(e=>t(I,{span:o?24:8,style:{marginBottom:"20px"},children:c("div",{className:B.content,children:[t("div",{className:B.title,id:`${x}-${e}-title`}),t("div",{style:{height:"300px",width:"100%",background:"#fff"},id:`${x}-${e}`})]})},e))})]})]})};export{Ce as default};
