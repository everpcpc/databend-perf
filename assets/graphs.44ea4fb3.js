import{r,i as te,L as ae}from"./react.7dc093bc.js";import{d as ne,F as w,u as se,g as O,a as re,b as ie,R as j,C as I,S as F}from"./device-type.d6a61e8e.js";import{B as le,T as oe,D as de,h as ce,f as G}from"./tools.96c33174.js";import{s as B}from"./styles.module.a3c36dde.js";import{j as c,a as t,m as pe}from"./index.24dc5ca2.js";import"./lodash.71f9f2ff.js";const{RangePicker:ue}=de,{Option:V}=F,ve=()=>{const{isPhone:o}=ne(),[P,z]=r.exports.useState([]),[x,T]=r.exports.useState(""),[$]=w.useForm(),[b,M]=r.exports.useState([]),[E,S]=r.exports.useState(!0),[W,k]=r.exports.useState(!1),[q,H]=r.exports.useState(""),[L,K]=r.exports.useState({filterDate:[],startIndex:0,endIndex:-1}),[X]=r.exports.useState([{name:"Raw",value:"raw"}]),[D,R]=r.exports.useState([]);se(()=>{Q()}),r.exports.useEffect(()=>{E||J()},[E]);async function J(){const e=await O(x);R(e),N(x,e,!1)}async function Q(){const{types:e,env:a}=await re();if(H(a),z(e||[]),e.length>0){$.setFieldsValue({category:e[0]}),S(!0),T(e[0]);const d=await O(e[0]);R(d),N(e[0],d,!0)}}async function N(e,a,d){const h=a.length;k(!0);try{for(let n=0;n<h;n++){const l=a[n];ie(e,l).then(i=>{n===0&&M(i==null?void 0:i.xAxis),U(e,l,i,n,d)})}k(!1)}catch(n){console.log(n),k(!1)}}function U(e,a,d,h,n){const l=`${e}-${a}`,i=document.getElementById(`${l}`);if(i){let y=document.getElementById(`${l}-title`),p=te(i),{legend:u,lines:f,sql:_,title:ee,version:v,xAxis:A}=d;if(y.innerHTML=`
        <span style='display: flex;'>
          <span style='font-weight: bold; padding-right: 10px;'>${ee}:</span><span style="font-size: 12px;">${_}</span>
        </span>
      `,!n){const{startIndex:s,endIndex:C,filterDate:m}=L;L.endIndex===-1?(A=m,f.map(g=>{g.data=g.data.slice(s)}),v=v.slice(s)):(A=m,f.map(g=>{g.data=g.data.slice(s,C+1)}),v=v.slice(s,C+1))}f==null||f.map(s=>s.type="line"),S(!0),p.setOption({legend:{data:u,y:"bottom"},tooltip:{extraCssText:"z-index: 10",trigger:"axis",position:o?["20%","-30%"]:void 0,formatter(s){let C=`${s[0].axisValue}<span style="display:inline-block;padding-left: 20px;">${v[s[0].dataIndex]}</span></br>`;return s.forEach((m,g)=>{C+=`<div>${m.marker} ${m.seriesName}:${m.data}</div>`}),C}},xAxis:{data:A,name:o?"":"date"},yAxis:{name:"s"},series:f}),p=null}}function Y(e){return e>ce().add(0,"days")}async function Z(){const{category:e,date:a,kind:d}=$.getFieldsValue();T(e);let h=null,n=null;a&&a.length>1&&(h=G(a[0]),n=G(a[1]));const l=b.indexOf(h),i=b.indexOf(n),y=l===-1?0:l,p=i;let u=[];if(p===-1?u=b.slice(y):u=b.slice(y,p+1),u.length<=0){pe.warning("No data was generated for this time range");return}S(!1),K({filterDate:u,startIndex:y,endIndex:p})}return c("div",{children:[t(w,{form:$,initialValues:{kind:"raw",category:x},children:c(j,{gutter:10,children:[t(I,{span:o?24:6,children:t(w.Item,{name:"date",label:"Date range",children:t(ue,{disabledDate:Y,style:{width:"100%"}})})}),t(I,{span:o?12:4,children:t(w.Item,{name:"kind",label:"Graph kind",children:t(F,{children:X.map((e,a)=>t(V,{value:e.value,children:e.name},a))})})}),t(I,{span:o?12:4,children:t(w.Item,{name:"category",label:"Category",children:t(F,{children:P.map((e,a)=>t(V,{value:e,children:e},a))})})}),t(le,{style:o?{width:"100%",marginBottom:"20px"}:{width:"auto"},loading:W,type:"primary",onClick:Z,children:"Submit"})]})}),c("div",{children:[c("div",{style:{marginBottom:"20px"},children:[c("div",{children:["See ",t(ae,{to:"/compare",children:"compare page"})," for descriptions of what the names mean."]}),c(oe,{style:{marginTop:"5px"},color:"blue",children:["Environment: ",q]})]}),t(j,{className:B.allChartWrap,id:"allChartWrap",gutter:10,children:D==null?void 0:D.map(e=>t(I,{span:o?24:8,style:{marginBottom:"20px"},children:c("div",{className:B.content,children:[t("div",{className:B.title,id:`${x}-${e}-title`}),t("div",{style:{height:"300px",width:"100%",background:"#fff"},id:`${x}-${e}`})]})},e))})]})]})};export{ve as default};
